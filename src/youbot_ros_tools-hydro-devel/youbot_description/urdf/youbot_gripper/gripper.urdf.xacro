<?xml version="1.0"?>
<robot name="youbot" xmlns:xacro="http://ros.org/wiki/xacro">

	<xacro:include filename="$(find youbot_description)/urdf/youbot_gripper/gripper.gazebo.xacro" />
	<xacro:include filename="$(find youbot_description)/urdf/youbot_gripper/gripper.transmission.xacro" />
	<xacro:include filename="$(find youbot_description)/urdf/youbot_gripper/limits.urdf.xacro" />

	<xacro:include filename="$(find youbot_description)/urdf/sensors/asus_xtion_camera.urdf.xacro" />

	<xacro:macro name="youbot_gripper" params="parent name *origin">

		<!-- joint between arm_link_5 and sdh_palm_link -->
		<joint name="${name}_palm_joint" type="fixed" >	
			<insert_block name="origin" />
			<parent link="${parent}" />
			<child link="${name}_palm_link" />
		</joint>

		<link name="${name}_palm_link">
			<inertial>
				<origin xyz="0 0 0" rpy="${M_PI} ${-M_PI / 2}  0"/>
				<mass value="0.1"/>
				<inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
			</inertial>
			
			<visual>
				<origin xyz="0 0 0" rpy="${M_PI} ${-M_PI / 2} 0" />
				<geometry>
					<mesh filename="package://youbot_description/meshes/youbot_gripper/palm.dae" />
				</geometry>
			</visual>
			
			<collision>
				<origin xyz="0 0 0" rpy="${M_PI} ${-M_PI / 2} 0" />
				<geometry>
					<!--<box size="0.050 0.094 0.054"/>-->
					<mesh filename="package://youbot_description/meshes/youbot_gripper/palm_convex.dae" />
				</geometry>
			</collision>
		</link>
<!--
		<link name="${name}_camera_collision_box_link">
			<collision>
				<origin xyz="0 0 0" rpy="0 ${-M_PI / 2} 0"/>
				<geometry>
					<box size="0.07 0.2 0.06"/>
				</geometry>
			</collision>
		</link>				
	-->
<!--
		<joint name="${name}_camera_collision_box_joint" type="fixed">
			<origin xyz="0 0 0.060" rpy="0 0 0"/>
			<parent link="${name}_palm_link"/>
			<child link ="${name}_camera_collision_box_link"/>
			<axis xyz="0 1 0"/>
		</joint>
	-->
	
	<joint name="${name}_finger_joint_l" type="prismatic">
		<origin xyz="0.046 0.010 0.003 " rpy="0 ${-M_PI / 2} ${M_PI}" />
		<parent link="${name}_palm_link"/>
		<child link="${name}_finger_link_l"/>
		<axis xyz="0 -1 0" />

		<dynamics damping="1.0" friction="1.0" />
		<limit effort="1" velocity="0.1" lower="0" upper="${finger_joint}"/> 
		<safety_controller k_position="20" k_velocity="25" soft_lower_limit="${gripper_threshold}" soft_upper_limit="${finger_joint_soft}" />
	</joint>

	<link name="${name}_finger_link_l">
		<inertial>
			<origin xyz="0 -0.001 0" rpy="0 0 0" />
			<mass value="0.01"/>
			<inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
		</inertial>

		<visual>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry>
				<mesh filename="package://youbot_description/meshes/youbot_gripper/finger.dae" />
			</geometry>
		</visual>

		<collision>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry>
				<!--<box size="0.014 0.020 0.046"/>-->
				<mesh filename="package://youbot_description/meshes/youbot_gripper/finger_convex.dae" />
			</geometry>
		</collision>
	</link>

	<joint name="${name}_finger_joint_r" type="prismatic">
		<origin xyz="0.046 -0.010 0.003" rpy="0 ${M_PI / 2} 0" />
		<parent link="${name}_palm_link"/>
		<child link="${name}_finger_link_r"/>
		<axis xyz="0 -1 0" />
		<dynamics damping="1.0" friction="1.0" />
		<limit effort="1" velocity="0.1" lower="0" upper="${finger_joint}"/> 
		<safety_controller k_position="20" k_velocity="25" soft_lower_limit="${gripper_threshold}" soft_upper_limit="${finger_joint_soft}" />
	</joint>

	<link name="${name}_finger_link_r">
		<inertial>
			<origin xyz="0.000 -0.001 0" rpy="0 0 0" />
			<mass value="0.01"/>
			<inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
		</inertial>

		<visual>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry>
				<mesh filename="package://youbot_description/meshes/youbot_gripper/finger.dae" />
			</geometry>
		</visual>

		<collision>
			<origin xyz="0.000 0 0" rpy="0 0 0" />
			<geometry>
				<!--<box size="0.014 0.020 0.046"/>-->
				<mesh filename="package://youbot_description/meshes/youbot_gripper/finger_convex.dae" />
			</geometry>
		</collision>
	</link>

	<!-- asus xtion camera
	<xacro:asus_xtion_camera name="xtion" parent="${name}_palm_link" tilt="0.0">
		<origin xyz="0.0197188 -0.0341838 0.0459352" rpy="0.0201114 0.00763208 3.0937" />
	</xacro:asus_xtion_camera>
	-->
	<!-- extensions -->
	<xacro:youbot_gripper_gazebo name="${name}" />
	<xacro:youbot_gripper_transmission name="${name}" />

</xacro:macro>

</robot>


